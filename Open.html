<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Pain Scale Widget</title>
</head>
<body>

<!-- Improved Pain Scale Widget with Perfect Alignment + Animations -->
<div id="pain-scale-container">
  <div class="header-animation">
    <h3>How much pain are you experiencing right now?</h3>
    <div class="loading-dots">
      <span></span>
      <span></span>
      <span></span>
    </div>
  </div>
  
  <div id="visual-analogue-scale">
    <div id="scale-track">
      <div class="gradient-flow"></div>
    </div>
    <div id="indicator" class="pulse">
      <div class="indicator-glow"></div>
    </div>
    <div id="scale-ticks-container">
      <div class="tick-mark animated-tick" style="--position: 0%;" data-delay="0">
        <span class="tick-label">0</span>
        <span class="tick-text">No Pain</span>
      </div>
      <div class="tick-mark animated-tick" style="--position: 20%;" data-delay="100">
        <span class="tick-label">2</span>
        <span class="tick-text">Mild</span>
      </div>
      <div class="tick-mark animated-tick" style="--position: 40%;" data-delay="200">
        <span class="tick-label">4</span>
        <span class="tick-text">Moderate</span>
      </div>
      <div class="tick-mark animated-tick" style="--position: 60%;" data-delay="300">
        <span class="tick-label">6</span>
        <span class="tick-text">Severe</span>
      </div>
      <div class="tick-mark animated-tick" style="--position: 80%;" data-delay="400">
        <span class="tick-label">8</span>
        <span class="tick-text">Very Severe</span>
      </div>
      <div class="tick-mark animated-tick" style="--position: 100%;" data-delay="500">
        <span class="tick-label">10</span>
        <span class="tick-text">Worst</span>
      </div>
    </div>
  </div>
  
  <div id="pain-feedback" class="fade-in-up">
    <div id="pain-value-container">
      <div id="pain-value" class="number-counter">0.0</div>
      <div id="pain-value-label">Pain Level</div>
      <div class="value-particles"></div>
    </div>
    <div id="pain-description-container">
      <div id="pain-description" class="text-shimmer">No Pain</div>
      <div id="pain-severity">Click or drag to set your pain level</div>
    </div>
    <div id="color-preview" class="color-pulse">
      <div class="color-ripple"></div>
    </div>
  </div>
  
  <button id="submit-pain" class="button-hover-effect">
    <span class="button-text">Record Pain Level</span>
    <div class="button-background"></div>
  </button>
  
  <div id="confirmation-message">
    <div class="success-icon">‚úì</div>
    Pain level recorded successfully!
  </div>
</div>

<!-- Wong-Baker FACES Pain Rating Scale with Animations -->
<div id="wong-baker-container" class="slide-in-left">
  <h3>Wong-Baker FACES Pain Rating Scale</h3>
  <div id="wong-baker-scale">
    <div class="face-option bounce-in" data-value="0" style="--delay: 0s">
      <span class="face-emoji">üòä</span>
      <span class="face-label">0</span>
      <span class="face-text">No Pain</span>
    </div>
    <div class="face-option bounce-in" data-value="2" style="--delay: 0.1s">
      <span class="face-emoji">üôÇ</span>
      <span class="face-label">2</span>
      <span class="face-text">Mild Pain</span>
    </div>
    <div class="face-option bounce-in" data-value="4" style="--delay: 0.2s">
      <span class="face-emoji">üòê</span>
      <span class="face-label">4</span>
      <span class="face-text">Moderate Pain</span>
    </div>
    <div class="face-option bounce-in" data-value="6" style="--delay: 0.3s">
      <span class="face-emoji">üò£</span>
      <span class="face-label">6</span>
      <span class="face-text">Severe Pain</span>
    </div>
    <div class="face-option bounce-in" data-value="8" style="--delay: 0.4s">
      <span class="face-emoji">üò¢</span>
      <span class="face-label">8</span>
      <span class="face-text">Very Severe Pain</span>
    </div>
    <div class="face-option bounce-in" data-value="10" style="--delay: 0.5s">
      <span class="face-emoji">üò≠</span>
      <span class="face-label">10</span>
      <span class="face-text">Worst Pain</span>
    </div>
  </div>
</div>

<!-- Educational Section with Animations -->
<div id="pain-scale-info" class="fade-in-up">
  <h4 class="typing-effect">About Pain Assessment Tools</h4>
  <p class="slide-in-text">These tools help measure pain intensity for better communication with healthcare providers.</p>
  
  <div class="info-section slide-in-right" style="--delay: 0.2s">
    <h5>üî¢ Numerical Rating Scale (NRS 0‚Äì10)</h5>
    <p>Rate your pain from 0 (no pain) to 10 (worst pain imaginable). It's simple and widely used in medical settings.</p>
  </div>
  
  <div class="info-section slide-in-right" style="--delay: 0.4s">
    <h5>üìè Visual Analogue Scale (VAS)</h5>
    <p>Slide or mark on a line from "no pain" to "worst pain" for a precise measure of pain intensity.</p>
  </div>
  
  <div class="info-section slide-in-right" style="--delay: 0.6s">
    <h5>üòä Wong-Baker FACES Pain Rating Scale</h5>
    <p>Choose a face from happy (no pain) to crying (worst pain) to express pain intensity, especially helpful for children or those with language barriers.</p>
  </div>
</div>

<style>
  /* Enhanced CSS with perfect alignment and animations */
  * {
    box-sizing: border-box;
  }

  body {
    margin: 0;
    padding: 20px;
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    min-height: 100vh;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  }

  /* Animation Keyframes */
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes slideInLeft {
    from {
      opacity: 0;
      transform: translateX(-50px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  @keyframes slideInRight {
    from {
      opacity: 0;
      transform: translateX(30px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  @keyframes bounceIn {
    0% {
      opacity: 0;
      transform: scale(0.3) translateY(-20px);
    }
    50% {
      opacity: 1;
      transform: scale(1.05) translateY(-5px);
    }
    70% {
      transform: scale(0.9) translateY(0);
    }
    100% {
      opacity: 1;
      transform: scale(1) translateY(0);
    }
  }

  @keyframes pulse {
    0% {
      transform: translateX(-50%) scale(1);
      box-shadow: 0 3px 10px rgba(0,0,0,0.2);
    }
    50% {
      transform: translateX(-50%) scale(1.1);
      box-shadow: 0 5px 20px rgba(0,0,0,0.3);
    }
    100% {
      transform: translateX(-50%) scale(1);
      box-shadow: 0 3px 10px rgba(0,0,0,0.2);
    }
  }

  @keyframes gradientFlow {
    0% {
      background-position: 0% 50%;
    }
    50% {
      background-position: 100% 50%;
    }
    100% {
      background-position: 0% 50%;
    }
  }

  @keyframes shimmer {
    0% {
      background-position: -200% center;
    }
    100% {
      background-position: 200% center;
    }
  }

  @keyframes colorPulse {
    0%, 100% {
      transform: scale(1);
    }
    50% {
      transform: scale(1.05);
    }
  }

  @keyframes ripple {
    0% {
      transform: scale(0);
      opacity: 0.8;
    }
    100% {
      transform: scale(2);
      opacity: 0;
    }
  }

  @keyframes dotPulse {
    0%, 20% {
      transform: scale(1);
      opacity: 1;
    }
    50% {
      transform: scale(1.5);
      opacity: 0.7;
    }
    100% {
      transform: scale(1);
      opacity: 1;
    }
  }

  @keyframes numberCount {
    0% {
      opacity: 0;
      transform: translateY(-10px) scale(0.8);
    }
    100% {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }

  /* Main Container */
  #pain-scale-container {
    max-width: 650px;
    margin: 25px auto;
    padding: 30px;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-radius: 20px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.1);
    position: relative;
    animation: fadeInUp 0.8s ease-out;
  }

  .header-animation {
    position: relative;
    margin-bottom: 30px;
  }

  #pain-scale-container h3 {
    text-align: center;
    color: #2c3e50;
    margin: 0 0 15px 0;
    font-weight: 600;
    font-size: 22px;
    line-height: 1.4;
  }

  .loading-dots {
    display: flex;
    justify-content: center;
    gap: 8px;
    margin-bottom: 15px;
  }

  .loading-dots span {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: #4CAF50;
    animation: dotPulse 1.5s infinite;
  }

  .loading-dots span:nth-child(2) {
    animation-delay: 0.2s;
  }

  .loading-dots span:nth-child(3) {
    animation-delay: 0.4s;
  }

  /* Visual Analogue Scale */
  #visual-analogue-scale {
    position: relative;
    height: 80px;
    margin: 0 auto 35px;
    width: 100%;
  }

  #scale-track {
    position: absolute;
    width: 100%;
    left: 0;
    height: 12px;
    background: linear-gradient(to right, 
      #4CAF50 0%, 
      #8BC34A 20%, 
      #FFEB3B 40%, 
      #FF9800 60%, 
      #F44336 80%, 
      #9C27B0 100%);
    border-radius: 6px;
    cursor: pointer;
    top: 28px;
    box-shadow: 0 3px 10px rgba(0,0,0,0.15);
    transition: all 0.3s ease;
    overflow: hidden;
  }

  .gradient-flow {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(90deg, 
      rgba(255,255,255,0.3) 0%, 
      rgba(255,255,255,0.1) 50%, 
      rgba(255,255,255,0.3) 100%);
    background-size: 200% 100%;
    animation: gradientFlow 3s ease-in-out infinite;
  }

  #scale-track:hover {
    box-shadow: 0 5px 20px rgba(0,0,0,0.2);
    transform: scaleY(1.1);
  }

  #indicator {
    position: absolute;
    width: 30px;
    height: 30px;
    background: radial-gradient(circle, #fff 0%, #f8f9fa 100%);
    border: 3px solid #2c3e50;
    border-radius: 50%;
    top: 18px;
    left: 0%;
    transform: translateX(-50%);
    z-index: 10;
    cursor: grab;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    overflow: hidden;
  }

  .indicator-glow {
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(76,175,80,0.3) 0%, transparent 70%);
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  #indicator:hover .indicator-glow {
    opacity: 1;
  }

  #indicator:active {
    cursor: grabbing;
  }

  .pulse {
    animation: pulse 2s infinite;
  }

  #indicator.dragging {
    animation: none;
    transform: translateX(-50%) scale(1.2);
    box-shadow: 0 8px 25px rgba(0,0,0,0.3);
    border-color: #1a252f;
  }

  #indicator.dragging .indicator-glow {
    opacity: 1;
    background: radial-gradient(circle, rgba(76,175,80,0.5) 0%, transparent 70%);
  }

  /* Tick Marks with Perfect Alignment */
  #scale-ticks-container {
    position: absolute;
    width: 100%;
    left: 0;
    top: 58px;
    height: 40px;
  }

  .tick-mark {
    position: absolute;
    left: var(--position);
    transform: translateX(-50%);
    text-align: center;
    width: 60px;
    margin-left: -30px;
  }

  .animated-tick {
    opacity: 0;
    animation: fadeInUp 0.6s ease-out forwards;
    animation-delay: calc(var(--delay, 0) * 1ms);
  }

  .tick-mark .tick-label {
    display: block;
    font-size: 14px;
    font-weight: 600;
    color: #2c3e50;
    margin-bottom: 5px;
    transition: all 0.3s ease;
  }

  .tick-mark .tick-text {
    display: block;
    font-size: 12px;
    color: #7f8c8d;
    line-height: 1.3;
    transition: all 0.3s ease;
  }

  .tick-mark::before {
    content: '';
    position: absolute;
    top: -25px;
    left: 50%;
    transform: translateX(-50%);
    width: 2px;
    height: 14px;
    background-color: #7f8c8d;
    transition: all 0.3s ease;
  }

  .tick-mark:hover::before {
    background-color: #2c3e50;
    height: 18px;
    top: -29px;
  }

  .tick-mark:hover .tick-label,
  .tick-mark:hover .tick-text {
    color: #2c3e50;
    transform: scale(1.1);
  }

  /* Pain Feedback Section */
  .fade-in-up {
    animation: fadeInUp 0.8s ease-out 0.3s backwards;
  }

  #pain-feedback {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin: 30px 0;
    padding: 25px;
    background: rgba(248, 249, 250, 0.8);
    backdrop-filter: blur(5px);
    border-radius: 15px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.08);
    flex-wrap: wrap;
    gap: 20px;
    border: 1px solid rgba(255,255,255,0.3);
  }

  #pain-value-container {
    text-align: center;
    min-width: 120px;
    position: relative;
  }

  .number-counter {
    font-size: 42px;
    font-weight: 700;
    color: #4CAF50;
    margin: 0;
    line-height: 1;
    transition: all 0.4s ease;
    text-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }

  .number-counter.updating {
    animation: numberCount 0.3s ease-out;
  }

  .value-particles {
    position: absolute;
    top: -10px;
    left: 50%;
    transform: translateX(-50%);
    width: 100px;
    height: 60px;
    pointer-events: none;
  }

  #pain-value-label {
    font-size: 14px;
    color: #7f8c8d;
    margin-top: 8px;
    font-weight: 500;
  }

  #pain-description-container {
    text-align: center;
    flex: 1;
    min-width: 200px;
  }

  .text-shimmer {
    font-size: 22px;
    font-weight: 600;
    color: #4CAF50;
    margin: 0 0 8px 0;
    transition: all 0.4s ease;
    background: linear-gradient(90deg, 
      currentColor 0%, 
      rgba(255,255,255,0.8) 50%, 
      currentColor 100%);
    background-size: 200% 100%;
    -webkit-background-clip: text;
    background-clip: text;
  }

  .text-shimmer.shimmer-active {
    animation: shimmer 1.5s ease-in-out;
  }

  #pain-severity {
    font-size: 14px;
    color: #7f8c8d;
    font-style: italic;
    transition: all 0.3s ease;
  }

  .color-pulse {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    border: 3px solid rgba(255,255,255,0.3);
    margin: 0 auto;
    transition: all 0.4s ease;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    position: relative;
    overflow: hidden;
    animation: colorPulse 2s infinite ease-in-out;
  }

  .color-ripple {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    transform: translate(-50%, -50%) scale(0);
    background: rgba(255,255,255,0.3);
    pointer-events: none;
  }

  .color-ripple.active {
    animation: ripple 0.6s ease-out;
  }

  /* Enhanced Submit Button */
  .button-hover-effect {
    display: block;
    margin: 30px auto 0;
    padding: 16px 40px;
    background: transparent;
    color: white;
    border: none;
    border-radius: 50px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    position: relative;
    overflow: hidden;
    min-width: 220px;
    transition: all 0.3s ease;
    box-shadow: 0 6px 20px rgba(76, 175, 80, 0.3);
  }

  .button-background {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, #4CAF50, #45a049);
    z-index: -1;
    transition: all 0.3s ease;
  }

  .button-text {
    position: relative;
    z-index: 2;
  }

  .button-hover-effect:hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 30px rgba(76, 175, 80, 0.4);
  }

  .button-hover-effect:hover .button-background {
    background: linear-gradient(135deg, #45a049, #3e8e41);
  }

  .button-hover-effect:active {
    transform: translateY(-1px);
    box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
  }

  /* Confirmation Message */
  #confirmation-message {
    text-align: center;
    margin: 20px auto 0;
    padding: 20px 25px;
    background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
    border-radius: 12px;
    color: #2e7d32;
    font-weight: 600;
    opacity: 0;
    height: 0;
    overflow: hidden;
    transition: all 0.6s ease;
    transform: translateY(-20px) scale(0.9);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    border: 2px solid rgba(76, 175, 80, 0.2);
  }

  .success-icon {
    font-size: 24px;
    font-weight: bold;
    color: #4CAF50;
    animation: bounceIn 0.6s ease-out;
  }

  #confirmation-message.show {
    opacity: 1;
    height: auto;
    transform: translateY(0) scale(1);
    margin-top: 25px;
  }

  /* Wong-Baker Scale */
  .slide-in-left {
    animation: slideInLeft 0.8s ease-out 0.5s backwards;
  }

  #wong-baker-container {
    max-width: 650px;
    margin: 25px auto;
    padding: 30px;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-radius: 20px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.1);
  }

  #wong-baker-container h3 {
    text-align: center;
    color: #2c3e50;
    margin: 0 0 30px 0;
    font-weight: 600;
    font-size: 22px;
    line-height: 1.4;
  }

  #wong-baker-scale {
    display: flex;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 15px;
  }

  .bounce-in {
    animation: bounceIn 0.8s ease-out;
    animation-delay: var(--delay);
    animation-fill-mode: backwards;
  }

  .face-option {
    text-align: center;
    width: 90px;
    cursor: pointer;
    padding: 15px 10px;
    border-radius: 15px;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    border: 2px solid transparent;
    background: rgba(255,255,255,0.5);
    backdrop-filter: blur(5px);
  }

  .face-option::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(76, 175, 80, 0.1), rgba(139, 195, 74, 0.1));
    border-radius: 15px;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .face-option:hover::before {
    opacity: 1;
  }

  .face-option:hover {
    transform: translateY(-5px) scale(1.05);
    box-shadow: 0 10px 25px rgba(0,0,0,0.15);
  }

  .face-option.selected {
    background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
    border: 2px solid #4CAF50;
    transform: scale(1.1);
    box-shadow: 0 8px 20px rgba(76, 175, 80, 0.3);
  }

  .face-emoji {
    display: block;
    font-size: 45px;
    margin-bottom: 8px;
    transition: all 0.3s ease;
  }

  .face-option:hover .face-emoji {
    transform: scale(1.2) rotate(5deg);
  }

  .face-label {
    display: block;
    font-size: 18px;
    font-weight: 600;
    color: #2c3e50;
    margin-bottom: 5px;
  }

  .face-text {
    display: block;
    font-size: 12px;
    color: #7f8c8d;
    font-weight: 500;
  }

  /* Educational Section */
  #pain-scale-info {
    max-width: 650px;
    margin: 40px auto;
    padding: 30px;
    background: rgba(248, 249, 250, 0.95);
    backdrop-filter: blur(10px);
    border-radius: 15px;
    border-left: 5px solid #4CAF50;
    box-shadow: 0 8px 30px rgba(0,0,0,0.1);
    animation: fadeInUp 1s ease-out 0.8s backwards;
  }

  #pain-scale-info h4 {
    color: #2c3e50;
    margin-top: 0;
    padding-bottom: 15px;
    border-bottom: 2px solid rgba(224, 224, 224, 0.5);
    font-size: 24px;
  }

  .slide-in-right {
    animation: slideInRight 0.6s ease-out;
    animation-delay: var(--delay, 0s);
    animation-fill-mode: backwards;
  }

  .info-section {
    margin-bottom: 25px;
    padding: 20px;
    border-radius: 10px;
    background: rgba(255,255,255,0.6);
    backdrop-filter: blur(5px);
    transition: all 0.3s ease;
    border: 1px solid rgba(255,255,255,0.3);
  }

  .info-section:hover {
    transform: translateX(5px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    background: rgba(255,255,255,0.8);
  }

  .info-section h5 {
    color: #2c3e50;
    margin: 0 0 10px 0;
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 18px;
  }

  .info-section p {
    color: #555;
    line-height: 1.6;
    margin: 0;
  }

  /* Responsive Design */
  @media (max-width: 768px) {
    #pain-scale-container, #wong-baker-container {
      margin: 15px;
      padding: 20px;
    }
    
    #wong-baker-scale {
      justify-content: center;
      gap: 10px;
    }
    
    .face-option {
      width: 75px;
      padding: 10px 5px;
    }
    
    .face-emoji {
      font-size: 35px;
    }
    
    .number-counter {
      font-size: 36px;
    }
    
    .text-shimmer {
      font-size: 18px;
    }
    
    #pain-feedback {
      flex-direction: column;
      text-align: center;
    }
  }

  @media (max-width: 480px) {
    .face-option {
      width: 65px;
    }
    
    .face-emoji {
      font-size: 30px;
    }
    
    .number-counter {
      font-size: 32px;
    }
    
    #indicator {
      width: 26px;
      height: 26px;
    }
    
    .tick-mark {
      width: 50px;
      margin-left: -25px;
    }
    
    .button-hover-effect {
      min-width: 180px;
      padding: 14px 30px;
    }
  }
</style>

<script>
// Enhanced JavaScript with perfect alignment and smooth animations
document.addEventListener('DOMContentLoaded', function() {
  const indicator = document.getElementById('indicator');
  const scaleTrack = document.getElementById('scale-track');
  const painValue = document.getElementById('pain-value');
  const painDescription = document.getElementById('pain-description');
  const painSeverity = document.getElementById('pain-severity');
  const colorPreview = document.getElementById('color-preview');
  const submitButton = document.getElementById('submit-pain');
  const confirmationMessage = document.getElementById('confirmation-message');
  const faceOptions = document.querySelectorAll('.face-option');
  
  let isDragging = false;
  let currentPainLevel = 0;
  let scaleRect = null;
  let animationTimeout = null;
  
  // Initialize loading animation
  setTimeout(() => {
    const loadingDots = document.querySelector('.loading-dots');
    if (loadingDots) {
      loadingDots.style.opacity = '0';
      loadingDots.style.transform = 'translateY(-10px)';
    }
  }, 3000);
  
  // Update scale dimensions
  function updateScaleDimensions() {
    scaleRect = scaleTrack.getBoundingClientRect();
  }
  
  // Initialize dimensions
  updateScaleDimensions();
  
  // Update on window resize
  window.addEventListener('resize', function() {
    updateScaleDimensions();
    // Maintain indicator position after resize
    const percentage = currentPainLevel / 10;
    indicator.style.left = `${percentage * 100}%`;
  });
  
  // Function to create particle effect
  function createParticleEffect(container, color) {
    const particle = document.createElement('div');
    particle.style.cssText = `
      position: absolute;
      width: 4px;
      height: 4px;
      background: ${color};
      border-radius: 50%;
      pointer-events: none;
      animation: particleFloat 1s ease-out forwards;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    `;
    
    // Add particle animation
    const style = document.createElement('style');
    style.textContent = `
      @keyframes particleFloat {
        0% {
          opacity: 1;
          transform: translate(-50%, -50%) scale(0);
        }
        50% {
          opacity: 0.8;
          transform: translate(-50%, -70px) scale(1);
        }
        100% {
          opacity: 0;
          transform: translate(-50%, -100px) scale(0.5);
        }
      }
    `;
    document.head.appendChild(style);
    
    container.appendChild(particle);
    
    setTimeout(() => {
      if (particle.parentNode) {
        particle.parentNode.removeChild(particle);
      }
    }, 1000);
  }
  
  // Function to trigger color ripple effect
  function triggerRippleEffect() {
    const ripple = colorPreview.querySelector('.color-ripple');
    ripple.classList.remove('active');
    void ripple.offsetWidth; // Force reflow
    ripple.classList.add('active');
  }
  
  // Function to update pain level with perfect alignment
  function updatePainLevel(clientX, snap = true) {
    if (!scaleRect) return;
    
    // Calculate relative position within the scale track
    let relativeX = clientX - scaleRect.left;
    
    // Constrain to scale boundaries
    relativeX = Math.max(0, Math.min(scaleRect.width, relativeX));
    
    // Calculate percentage (0 to 1)
    let percentage = relativeX / scaleRect.width;
    
    // Snap to nearest tick mark (0, 2, 4, 6, 8, 10)
    if (snap) {
      const tickValues = [0, 2, 4, 6, 8, 10];
      const rawPainLevel = percentage * 10;
      currentPainLevel = tickValues.reduce((prev, curr) =>
        Math.abs(curr - rawPainLevel) < Math.abs(prev - rawPainLevel) ? curr : prev
      );
      percentage = currentPainLevel / 10;
    } else {
      currentPainLevel = parseFloat((percentage * 10).toFixed(1));
    }
    
    // Perfect alignment: indicator position matches scale exactly
    indicator.style.left = `${percentage * 100}%`;
    
    // Add number counting animation
    painValue.classList.add('updating');
    clearTimeout(animationTimeout);
    animationTimeout = setTimeout(() => {
      painValue.classList.remove('updating');
    }, 300);
    
    // Update display with animations
    painValue.textContent = currentPainLevel.toFixed(1);
    
    // Update description based on pain level
    updatePainDescription(currentPainLevel);
    
    // Update color preview with ripple effect
    updateColorPreview(percentage);
    triggerRippleEffect();
    
    // Create particle effect
    const valueContainer = document.getElementById('pain-value-container');
    const particleContainer = valueContainer.querySelector('.value-particles');
    if (particleContainer) {
      createParticleEffect(particleContainer, getCurrentColor(percentage));
    }
    
    // Update Wong-Baker selection
    updateWongBakerSelection(currentPainLevel);
    
    // Add shimmer effect to description
    painDescription.classList.add('shimmer-active');
    setTimeout(() => {
      painDescription.classList.remove('shimmer-active');
    }, 1500);
  }
  
  // Function to get current color based on percentage
  function getCurrentColor(percentage) {
    const colors = [
      { pos: 0, color: '#4CAF50' },
      { pos: 0.2, color: '#8BC34A' },
      { pos: 0.4, color: '#FFC107' },
      { pos: 0.6, color: '#FF9800' },
      { pos: 0.8, color: '#F44336' },
      { pos: 1, color: '#9C27B0' }
    ];
    
    for (let i = 0; i < colors.length - 1; i++) {
      if (percentage >= colors[i].pos && percentage <= colors[i + 1].pos) {
        const localPercentage = (percentage - colors[i].pos) / (colors[i + 1].pos - colors[i].pos);
        return interpolateColors(colors[i].color, colors[i + 1].color, localPercentage);
      }
    }
    return colors[colors.length - 1].color;
  }
  
  // Function to update pain description
  function updatePainDescription(level) {
    const descriptions = [
      { max: 1.0, text: "No Pain", color: "#4CAF50", severity: "Comfortable, no discomfort" },
      { max: 3.0, text: "Mild Pain", color: "#8BC34A", severity: "Noticeable but manageable" },
      { max: 5.0, text: "Moderate Pain", color: "#FFC107", severity: "Distracting, affects activities" },
      { max: 7.0, text: "Severe Pain", color: "#FF9800", severity: "Limits daily activities" },
      { max: 9.0, text: "Very Severe Pain", color: "#F44336", severity: "Hard to do most activities" },
      { max: 10.0, text: "Worst Pain", color: "#9C27B0", severity: "Needs immediate help" }
    ];
    
    const desc = descriptions.find(d => level <= d.max) || descriptions[descriptions.length - 1];
    
    painDescription.textContent = desc.text;
    painDescription.style.color = desc.color;
    painValue.style.color = desc.color;
    painSeverity.textContent = desc.severity;
  }
  
  // Function to update color preview
  function updateColorPreview(percentage) {
    const color = getCurrentColor(percentage);
    colorPreview.style.backgroundColor = color;
    colorPreview.style.boxShadow = `0 6px 20px ${color}60`;
    
    // Update ripple color
    const ripple = colorPreview.querySelector('.color-ripple');
    ripple.style.background = `${color}40`;
  }
  
  // Function to interpolate between two hex colors
  function interpolateColors(color1, color2, factor) {
    const r1 = parseInt(color1.slice(1, 3), 16);
    const g1 = parseInt(color1.slice(3, 5), 16);
    const b1 = parseInt(color1.slice(5, 7), 16);
    
    const r2 = parseInt(color2.slice(1, 3), 16);
    const g2 = parseInt(color2.slice(3, 5), 16);
    const b2 = parseInt(color2.slice(5, 7), 16);
    
    const r = Math.round(r1 + factor * (r2 - r1));
    const g = Math.round(g1 + factor * (g2 - g1));
    const b = Math.round(b1 + factor * (b2 - b1));
    
    return `rgb(${r}, ${g}, ${b})`;
  }
  
  // Function to update Wong-Baker selection
  function updateWongBakerSelection(level) {
    faceOptions.forEach(option => {
      const value = parseFloat(option.getAttribute('data-value'));
      const isSelected = Math.abs(value - level) < 0.5;
      
      if (isSelected && !option.classList.contains('selected')) {
        // Add selection animation
        option.style.animation = 'none';
        void option.offsetWidth; // Force reflow
        option.style.animation = 'bounceIn 0.6s ease-out';
      }
      
      option.classList.toggle('selected', isSelected);
    });
  }
  
  // Mouse/touch event handlers for VAS
  function handleStart(e) {
    e.preventDefault();
    isDragging = true;
    indicator.classList.add('dragging');
    
    const clientX = e.clientX || (e.touches && e.touches[0] ? e.touches[0].clientX : 0);
    if (clientX) {
      updatePainLevel(clientX, false);
    }
  }
  
  function handleMove(e) {
    if (!isDragging) return;
    e.preventDefault();
    
    const clientX = e.clientX || (e.touches && e.touches[0] ? e.touches[0].clientX : 0);
    if (clientX) {
      updatePainLevel(clientX, false);
    }
  }
  
  function handleEnd() {
    if (!isDragging) return;
    isDragging = false;
    indicator.classList.remove('dragging');
    // Snap to nearest tick mark on release
    const percentage = currentPainLevel / 10;
    updatePainLevel(scaleRect.left + percentage * scaleRect.width);
  }
  
  // Add event listeners for VAS
  scaleTrack.addEventListener('mousedown', handleStart);
  indicator.addEventListener('mousedown', handleStart);
  
  document.addEventListener('mousemove', handleMove);
  document.addEventListener('mouseup', handleEnd);
  
  scaleTrack.addEventListener('touchstart', handleStart, { passive: false });
  indicator.addEventListener('touchstart', handleStart, { passive: false });
  
  document.addEventListener('touchmove', handleMove, { passive: false });
  document.addEventListener('touchend', handleEnd);
  
  scaleTrack.addEventListener('click', function(e) {
    if (!isDragging) {
      updatePainLevel(e.clientX);
    }
  });
  
  // Wong-Baker scale event listeners with enhanced animations
  faceOptions.forEach(option => {
    option.addEventListener('click', function() {
      const value = parseFloat(this.getAttribute('data-value'));
      currentPainLevel = value;
      const percentage = value / 10;
      
      // Animate indicator movement
      indicator.style.transition = 'left 0.5s cubic-bezier(0.4, 0, 0.2, 1)';
      indicator.style.left = `${percentage * 100}%`;
      
      setTimeout(() => {
        indicator.style.transition = '';
      }, 500);
      
      painValue.textContent = value.toFixed(1);
      updatePainDescription(value);
      updateColorPreview(percentage);
      updateWongBakerSelection(value);
      
      // Trigger effects
      triggerRippleEffect();
      painDescription.classList.add('shimmer-active');
      setTimeout(() => {
        painDescription.classList.remove('shimmer-active');
      }, 1500);
    });
    
    // Add hover sound effect (visual feedback)
    option.addEventListener('mouseenter', function() {
      this.style.transform = 'translateY(-5px) scale(1.05)';
    });
    
    option.addEventListener('mouseleave', function() {
      if (!this.classList.contains('selected')) {
        this.style.transform = '';
      }
    });
  });
  
  // Enhanced submit button with loading animation
  submitButton.addEventListener('click', function() {
    // Add loading state
    const buttonText = this.querySelector('.button-text');
    const originalText = buttonText.textContent;
    
    buttonText.textContent = 'Recording...';
    this.style.pointerEvents = 'none';
    this.style.opacity = '0.8';
    
    // Simulate processing time
    setTimeout(() => {
      buttonText.textContent = originalText;
      this.style.pointerEvents = '';
      this.style.opacity = '';
      
      // Show confirmation with enhanced animation
      confirmationMessage.classList.add('show');
      
      // Create success particles
      for (let i = 0; i < 5; i++) {
        setTimeout(() => {
          createSuccessParticle();
        }, i * 100);
      }
      
      setTimeout(() => {
        confirmationMessage.classList.remove('show');
      }, 4000);
    }, 1500);
    
    console.log(`Pain level recorded: ${currentPainLevel} - ${painDescription.textContent}`);
  });
  
  // Function to create success particles
  function createSuccessParticle() {
    const particle = document.createElement('div');
    particle.style.cssText = `
      position: fixed;
      width: 8px;
      height: 8px;
      background: #4CAF50;
      border-radius: 50%;
      pointer-events: none;
      z-index: 1000;
      animation: successParticle 2s ease-out forwards;
      top: ${window.innerHeight / 2}px;
      left: ${window.innerWidth / 2}px;
    `;
    
    // Random direction
    const angle = Math.random() * Math.PI * 2;
    const distance = 100 + Math.random() * 100;
    const endX = Math.cos(angle) * distance;
    const endY = Math.sin(angle) * distance;
    
    const style = document.createElement('style');
    style.textContent = `
      @keyframes successParticle {
        0% {
          opacity: 1;
          transform: translate(0, 0) scale(1);
        }
        100% {
          opacity: 0;
          transform: translate(${endX}px, ${endY}px) scale(0);
        }
      }
    `;
    document.head.appendChild(style);
    
    document.body.appendChild(particle);
    
    setTimeout(() => {
      if (particle.parentNode) {
        particle.parentNode.removeChild(particle);
      }
      if (style.parentNode) {
        style.parentNode.removeChild(style);
      }
    }, 2000);
  }
  
  // Initialize with default value (no pain) after a short delay
  setTimeout(() => {
    updateScaleDimensions();
    updatePainLevel(scaleRect.left);
  }, 200);
  
  // Add intersection observer for scroll animations
  const observerOptions = {
    threshold: 0.1,
    rootMargin: '0px 0px -50px 0px'
  };
  
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.style.animationPlayState = 'running';
      }
    });
  }, observerOptions);
  
  // Observe animated elements
  document.querySelectorAll('.fade-in-up, .slide-in-left, .slide-in-right').forEach(el => {
    observer.observe(el);
  });
});
</script>

</body>
</html>
